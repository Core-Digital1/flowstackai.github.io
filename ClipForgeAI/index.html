<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipForge AI - Professional Editor</title>

    <!-- EXACT IMPORTS FROM DASHBOARD.HTML -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- CLIPFORGE SPECIFIC -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.3.0/dist/imgly-background-removal.min.js"></script>

    <style>
        :root {
            --primary-color: #4a6cf7;
            --accent-gradient: linear-gradient(135deg, #4a6cf7 0%, #6a11cb 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: white;
        }

        /* Dashboard-like Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        .tool-btn {
            @apply p-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-xl transition flex flex-col items-center gap-1 text-xs;
        }

        .tool-btn.active {
            @apply text-purple-400 bg-purple-500/10;
        }

        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #a855f7;
            cursor: pointer;
            margin-top: -6px;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #4b5563;
            border-radius: 2px;
        }

        .loading-shimmer {
            background: linear-gradient(90deg, #1f2937 25%, #374151 50%, #1f2937 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }
    </style>
</head>

<body class="bg-gray-950 text-white min-h-screen">

    <!-- APP CONTAINER -->
    <div id="app" class="h-full flex flex-col"></div>

    <!-- AUTH MODAL (Styled to match FlowStack) -->
    <div id="auth-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeAuthModal()"></div>
        <div class="relative bg-gray-900 border border-gray-700 rounded-2xl p-8 w-full max-w-md">
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i
                    data-lucide="x" class="w-6 h-6"></i></button>
            <h2 id="modal-title" class="text-2xl font-bold text-white mb-6">Welcome Back</h2>
            <form id="auth-form" class="space-y-4" onsubmit="handleAuthSubmit(event)">
                <div id="name-field" class="relative hidden">
                    <input type="text" id="input-name" placeholder="Full Name"
                        class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-purple-500 outline-none">
                </div>
                <input type="email" id="input-email" placeholder="Email Address" required
                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-purple-500 outline-none">
                <input type="password" id="input-password" placeholder="Password" required
                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-purple-500 outline-none">
                <button type="submit" id="auth-submit-btn"
                    class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-bold hover:opacity-90 transition">Login</button>
            </form>
            <div id="auth-footer" class="mt-6 text-center text-gray-400 text-sm"></div>
        </div>
    </div>

    <script>
        // --- SUPABASE CONFIG (Valid FlowStack Keys) ---
        const supabaseUrl = 'https://mgoaydvrlelrwompqjph.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1nb2F5ZHZybGVscndvbXBxanBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MjM2MzcsImV4cCI6MjA4NTA5OTYzN30.WGIJPXxL0QhBo3TpcTf8bNX9YMbVEtZztX1NtToZXRM';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey, { auth: { storage: window.sessionStorage } });

        // --- STATE & VIEWS ---
        let currentUser = null;
        let currentAuthMode = 'login';
        let activeTab = 'editor';
        let canvas = null;
        let activeObject = null;

        document.addEventListener('DOMContentLoaded', async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) { currentUser = session.user; renderDashboard(); }
            else { renderLanding(); }
            lucide.createIcons();
        });

        // --- RENDER FUNCTIONS ---
        function renderLanding() {
            document.getElementById('app').innerHTML = `
                <div class="overflow-y-auto h-screen">
                    <nav class="fixed w-full z-40 bg-gray-900/80 backdrop-blur-md border-b border-gray-800">
                        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
                            <div class="flex items-center gap-2 font-bold text-xl"><i data-lucide="zap" class="text-purple-500"></i> ClipForge AI</div>
                            <div>
                                <button onclick="openAuthModal('login')" class="text-gray-300 hover:text-white mr-4">Log in</button>
                                <button onclick="openAuthModal('signup')" class="bg-white text-gray-900 px-4 py-2 rounded-full font-medium hover:bg-gray-100">Sign up</button>
                            </div>
                        </div>
                    </nav>
                    <div class="pt-32 pb-20 text-center px-4">
                        <h1 class="text-5xl font-bold mb-6 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">Turn Videos into Viral Shorts</h1>
                        <p class="text-xl text-gray-400 mb-8">Professional editor in your browser.</p>
                        <button onclick="openAuthModal('signup')" class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-3 rounded-full text-lg font-semibold shadow-lg shadow-purple-500/30">Start Creating</button>
                    </div>
                </div>`;
            lucide.createIcons();
        }

        function renderDashboard() {
            document.getElementById('app').innerHTML = `
                <div class="flex h-screen overflow-hidden">
                    <aside class="w-20 bg-gray-900 border-r border-gray-800 flex flex-col items-center py-6">
                        <i data-lucide="zap" class="w-8 h-8 text-purple-500 mb-8"></i>
                        <nav class="flex-1 space-y-6 w-full flex flex-col items-center">
                            <button onclick="switchTab('editor')" id="nav-editor" class="p-3 rounded-xl text-purple-400 bg-purple-500/10"><i data-lucide="scissors"></i></button>
                            <button onclick="switchTab('upload')" id="nav-upload" class="p-3 rounded-xl text-gray-400 hover:bg-gray-800"><i data-lucide="upload"></i></button>
                            <button onclick="switchTab('settings')" id="nav-settings" class="p-3 rounded-xl text-gray-400 hover:bg-gray-800"><i data-lucide="settings"></i></button>
                        </nav>
                        <button onclick="logout()" class="p-3 text-gray-400 hover:text-red-400"><i data-lucide="log-out"></i></button>
                    </aside>
                    <main class="flex-1 bg-gray-950 relative" id="workspace-area"></main>
                </div>`;
            switchTab('editor');
            lucide.createIcons();
        }

        function switchTab(tab) {
            activeTab = tab;
            document.querySelectorAll('aside nav button').forEach(b => b.className = 'p-3 rounded-xl text-gray-400 hover:bg-gray-800');
            const btn = document.getElementById(`nav-${tab}`);
            if (btn) btn.className = 'p-3 rounded-xl text-purple-400 bg-purple-500/10';

            const ws = document.getElementById('workspace-area');
            if (tab === 'editor') {
                ws.innerHTML = getEditorHTML();
                initCanvas();
                setToolCategory('elements');
            } else if (tab === 'upload') {
                ws.innerHTML = `<div class="p-10"><h2 class="text-3xl font-bold mb-4">Uploads</h2><div class="border-2 border-dashed border-gray-700 rounded-xl p-10 text-center"><p class="text-gray-400">Drag files here</p></div></div>`;
            } else if (tab === 'settings') {
                renderSettings(ws);
            }
            lucide.createIcons();
        }

        function getEditorHTML() {
            return `
            <div class="flex flex-col h-full">
                <header class="h-14 bg-gray-900 border-b border-gray-800 flex items-center justify-between px-6">
                    <span class="font-semibold">Untitled Project</span>
                    <button class="bg-blue-600 px-4 py-1.5 rounded-lg text-sm">Export</button>
                </header>
                <div class="flex-1 flex overflow-hidden">
                    <div class="w-72 bg-gray-900 border-r border-gray-800 flex flex-col">
                        <div class="p-4 border-b border-gray-800 flex gap-2 overflow-x-auto">
                            <button onclick="setToolCategory('elements')" class="px-3 py-1 bg-gray-800 rounded text-sm">Elements</button>
                            <button onclick="setToolCategory('text')" class="px-3 py-1 hover:bg-gray-800 rounded text-sm text-gray-400">Text</button>
                            <button onclick="setToolCategory('ai')" class="px-3 py-1 hover:bg-gray-800 rounded text-sm text-purple-400">AI Tools</button>
                        </div>
                        <div id="tools-content" class="p-4 overflow-y-auto space-y-4"></div>
                    </div>
                    <div class="flex-1 bg-black flex items-center justify-center relative bg-gray-950/50" id="canvas-wrapper">
                        <canvas id="main-canvas"></canvas>
                    </div>
                    <div class="w-64 bg-gray-900 border-l border-gray-800 p-4" id="properties-panel">
                        <p class="text-center text-gray-500 mt-10">Select an object</p>
                    </div>
                </div>
            </div>`;
        }

        // --- EDITOR LOGIC (Identical to previous, compressed for stability) ---
        function initCanvas() {
            setTimeout(() => {
                const wrapper = document.getElementById('canvas-wrapper');
                if (!wrapper) return;
                const h = wrapper.clientHeight - 40;
                const w = h * (9 / 16);
                const cel = document.getElementById('main-canvas');
                cel.width = w; cel.height = h;
                canvas = new fabric.Canvas('main-canvas', { width: w, height: h, backgroundColor: '#000' });
                canvas.on('selection:created', onSel); canvas.on('selection:updated', onSel); canvas.on('selection:cleared', () => { activeObject = null; renderProps(); });
            }, 100);
        }
        function onSel(e) { activeObject = e.selected[0]; renderProps(); }
        function renderProps() {
            const p = document.getElementById('properties-panel');
            if (!activeObject) { p.innerHTML = '<p class="text-center text-gray-500 mt-10">Select Object</p>'; return; }
            p.innerHTML = `<div class="space-y-4"><label class="text-xs text-gray-400">Color</label><input type="color" value="${activeObject.fill}" onchange="activeObject.set('fill',this.value);canvas.renderAll()" class="w-full h-8 rounded"><button onclick="canvas.remove(activeObject);canvas.discardActiveObject();renderProps()" class="w-full py-2 bg-red-900/30 text-red-500 rounded text-sm">Delete</button></div>`;
        }
        function setToolCategory(cat) {
            const c = document.getElementById('tools-content');
            if (cat === 'elements') c.innerHTML = '<div class="grid grid-cols-3 gap-2"><button onclick="addRect()" class="bg-gray-800 p-2 rounded"><div class="w-6 h-6 border bg-purple-500"></div></button><button onclick="addCircle()" class="bg-gray-800 p-2 rounded"><div class="w-6 h-6 rounded-full bg-pink-500"></div></button></div>';
            if (cat === 'text') c.innerHTML = '<button onclick="addText(\'Heading\')" class="w-full p-3 bg-gray-800 rounded text-left font-bold">Add Heading</button>';
            if (cat === 'ai') c.innerHTML = '<div class="p-3 bg-gray-800 rounded border border-purple-500/30"><h3 class="text-purple-400 text-sm mb-2">Magic Eraser</h3><button onclick="removeBg()" class="w-full py-1 bg-purple-600 rounded text-sm">Remove BG</button></div>';
        }
        function addRect() { canvas.add(new fabric.Rect({ left: 50, top: 50, fill: '#8b5cf6', width: 60, height: 60 })); }
        function addCircle() { canvas.add(new fabric.Circle({ left: 80, top: 80, fill: '#ec4899', radius: 30 })); }
        function addText(t) { canvas.add(new fabric.IText(t, { left: 50, top: 100, fill: '#fff', fontFamily: 'Inter' })); }
        async function removeBg() {
            if (!activeObject || activeObject.type !== 'image') return alert('Select Image');
            try { const b = await imglyRemoveBackground(activeObject.toDataURL({ format: 'png' })); fabric.Image.fromURL(URL.createObjectURL(b), i => { canvas.remove(activeObject); canvas.add(i); }); } catch (e) { alert(e); }
        }
        function renderSettings(ws) { ws.innerHTML = '<div class="p-10"><h2 class="text-2xl font-bold">API Settings</h2><input placeholder="OpenAI Key" class="w-full bg-gray-900 p-2 border border-gray-700 rounded mt-4"></div>'; }

        // --- AUTH LOGIC ---
        function openAuthModal(mode) {
            currentAuthMode = mode;
            const m = document.getElementById('auth-modal'); m.classList.remove('hidden');
            document.getElementById('modal-title').innerText = mode === 'login' ? 'Log In' : 'Sign Up';
            document.getElementById('name-field').classList.toggle('hidden', mode === 'login');
            document.getElementById('auth-submit-btn').innerText = mode === 'login' ? 'Login' : 'Create Account';
            document.getElementById('auth-footer').innerHTML = mode === 'login' ? '<span onclick="openAuthModal(\'signup\')" class="cursor-pointer text-purple-400">Create Account</span>' : '<span onclick="openAuthModal(\'login\')" class="cursor-pointer text-purple-400">Log In</span>';
        }
        function closeAuthModal() { document.getElementById('auth-modal').classList.add('hidden'); }
        async function handleAuthSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('input-email').value;
            const pass = document.getElementById('input-password').value;
            const { data, error } = currentAuthMode === 'signup' ? await supabase.auth.signUp({ email, password }) : await supabase.auth.signInWithPassword({ email, password });
            if (error) alert(error.message);
            else { if (data.session) { currentUser = data.user; closeAuthModal(); renderDashboard(); } else alert('Check email.'); }
        }
        async function logout() { await supabase.auth.signOut(); currentUser = null; renderLanding(); }
    </script>
</body>

</html>